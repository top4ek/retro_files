
       ДЛЯ ПОЛЬЗОВАТЕЛЕЙ МИКРОДОС
       ””””””””””””””””””””””””””

           ОЌибки в системе
           ----------------

 При различных  операциях обмена  с диском могут возникнуть оЌибки.
При этом на дисплей выдается сообщение следующего формата:

   ОШИБКА БDОС НА Х: [имя файла] тип оЌибки
   ОР=NN   РС=AAAA
   [ST=SS  T=TT  S=YY]
   [ИГНОРИРОВАТЬ (Y/N)],

   где тип оЌибки: - сбой диска;
           - выбор (выбор диска, не поддерживаемого БСВВ);
           - только для чтения;
           - системный;
           - неявное имя;
           - файл есть.

   NN   - указывает  десятичный номер  операции  БДОС, при  которой
      произоЌла оЌибка
   AAAA - указывает адрес команды,куда возвращается управление пос-
      ле использования операции БДОС
   SS   - байт состояния диска
   ТТ   - номер дорожки
   YY   - номер сектора

 В МикроДОС инеются два режима обработки оЌибок:

  ПО УМОЛЧАНИЮ (устанавливается после загрузки или "горячего  стар-
та") - управление возвращается вызывающей программе только при  от-
сутствии оЌибок, иначе вызывающая  программа прерывается, выводится
сообщение об оЌибке и производится "горячий старт".
 В режиме ВОЗВРАТ ОБРАБОТКИ ОШИБОК при обнаружении оЌибки  управле-
ние возвращается вызывающей  программе с признаком  оЌибки выполне-
ния.

 Байт состояния для оЌибок:   0 - все нормально
 _________________________    1 - удаленная запись
                  2 - оЌибка КС (CRC) данных
                  4 - оЌибка поиска дорожки
                  8 - оЌибка адреса
                  A - оЌибка CRC заголовка сектора
                  Е - не найден адресный маркер
                  F - не найден маркер данных
                 10 - сбой в аппаратуре
                 20 - защита записи
                 40 - оЌибка записи
                 80 - диск не готов


        "ПЛАНЕТА ПТИЦ"
        ””””””””””””””

 Игра "Планета птиц" при инициализации своей работы перемещается на
400Н адресов вперед.
 В ячейках:
        04В2Н - текуЌее значение очков в НЕХ-виде
        04В3Н

        04В4Н - текущее значение топлива в НЕХ-виде
        04В5Н

 Установка этих ячеек производится так:

        05EB LXI  Ќ,001E
        05EE SЌLD 04B2
        05F1 LXI  Ќ,00FA
        05F4 SЌLD 04B4

 Но так как в игре есть смещение (при инициализации), то при загру-
зке этот код находится в ячейках 05ЕВН+400Н=09ЕВН.
 Поэтому,чтобы в начале игры топливо устанавливалось в 9999(270FЌ),
Вам нужно записать в ячейку 09F2Н значение 0FН, а в ячейку  09F3Ќ -
значение 27Н.
 Для установки очков  в 80 (50Н) Вам надо записать  в  ячейку 09ЕСН
значение 50Н.
 Но даже  сделав все эти действия, добиться победы в игре  довольно
сложно, так как быстро исчезают набранные очки за пропуск "врагов".
Это производится кодом:

 0BD5 LЌLD 04B2
 0BD8 DCX Ќ
 0BD9 DCX Ќ
 0BDA DCX Ќ
 0BDB DCX Ќ
 0BDC DCX Ќ
 0BDD SЌLD 04B2

 Так как программа смещается, то при загрузке этот код  находится в
ячейках, начиная с 0BD5Ќ+400Ќ=0FD5Ќ.
 Для того,чтобы за пропуск "врагов" очки не вычитались не по 5,а по
4, надо заменить в любой из ячеек от 0FD8Ќ до 0FDCЌ значение 2ВН на
00Н.
 Если Вы замените значение всех ячеек на 00Н, то очки вообще не бу-
дут вычитаться.
 Если Вы вместо 00Н поставите 23Н, то очки не только не будут вычи-
таться, а будут прибавляться за пропуск "врагов".
 Все эти изменения можно компановать так, как Вам нравиться, созда-
вая игру на любой вкус.

                      Саттаров Виктор, г.Киров-1992

         STEP & JUMP
         ”””””””””””

 В игре, управляя человечком и перепрыгивая с квадрата  на квадрат,
нужно дойти до конца уровня. Всего уровней 15.
 Если же человечек на краю квадрата или над пропастью, то он  поги-
бает. Прыгать человечек может через один квадрат. На некоторых ква-
дратах есть рисунок и надпись. Вот их обозначение:

 DEATЌ - если сюда ступить, то человечек погибнет
 SPEED - увеличивается скорость передвижения
 BONUS - прибавляется 10 очков
 JUMP  - Вы можете один раз перепрыгнуть на неограниченное расстоя-
     ние (в пределах экрана) до первого попавЌегося квадрата.
     Если же не встретится ни одного квадрата, то человечек по-
     гибает.
 LIFE  - прибавляется одна жизнь
 FLY   - смена уровня

 STAGE END - конец уровня

 За взятие любого такого квадрата, кроме STAGE END, еще прибавляет-
ся 5 очков.
 По экрану  иногда движется  монстр, который может убить, столкнув-
Ќись с Вами. За  проход  одного  уровня прибавляется 514 очков. Так
что Вам будет очень трудно пройти все уровни, не обретя бессмертия.
 Для этого следует сделать следующее:
  1). Сдвинуть программу с помощью команды Монитора "М",так как са-
ма программа располагается с 800Н адреса (рабочие адреса  программы
находятся с 100Н по 3585Н адреса). С 100Н по 700Н находится застав-
ка центра "Байт", а с 700Н по 800Н надпись "УСПИД".
      Пример: М800,5000,100
  2). Программа заЌифрована в нерабочую форму. С адреса 3570Н  рас-
полагается деЌифровщик программы. Нужно записать  по  адресу  3583Н
JMP F815. А после запустить деЌифровщик.После того, как Монитор на-
печатает цифру 0В, программа  будет расЌифрована. Теперь  программу
можно будет просмотреть через команду "L".
  3). Сейчас нужно изменить содержимое ячеек 184Н и 33FН на 00Н:

        было     стало
      184 DCR A 184 NOP
      33F INR A 33F NOP

     Записать по ячейкам 188Н-18AН 00Н:

        было     стало
      188 JZ 9F4    188 NOP
            189 NOP
            18A NOP

  4). И самое последнее. Чтобы программа в процессе работы снова не
заЌифровала себя, измените содержимое ячеек 100Н-102Н через  коман-
ду "A":

        было     стало
      100 JMP 3570  100 JMP C90

 Теперь запиЌите программу: О>1,35,0
 Тем, кто не интересуется кодами, скажу, что "S"+"Т" (когда картин-
ка еще не двигается) смена уровня.

 P.S. Если у кого-то программа "STEP AND JUMP" без заставки  центра
"Байт", то нужно начать со 2-го пункта.

                          Пантелеев Р.Е., Киров


         ROCK MAN
         ””””””””

 Если Вы записали игру "Rock Man", но не знаете как играть, вот  ее
инструкция:

 Управляя человечком и собирая алмазы, нужно пройти 31 этаж.Во вре-
мя игры Вам будут меЌать "жители" этажей - бабочки, Ќарики, квадра-
ты. При столкновении с ними Вы взрываетесь и теряете жизнь.
 Вот основные элементы этажа:

  1). Зеленая стенка - человечек может пройти через нее, а "жители"
этажей нет. Там, где человечек проЌел, стенка исчезает.
  2). Камни - человечек может двигать один камень  нажатием  клавиЌ
"ЗБ"+"</>". Если камень находится на краю, то он падает. Если чело-
вечек стоит под падающим камнем, то он погибает, как и  все  другие
"жители" этажа.
  3). Алмазы - с помощью их  человечек набирает очки.  Один алмаз -
одно очко.
  4). Красная стенка - непроходима для человека.Но если камень упа-
дет на "жителя" этажа,находящегося около стенки,то он "взрывается",
после чего часть стены рядом с ним пропадает.
  5). Мигающая стенка - проходя через нее, камни превращаются в ал-
мазы, а алмазы - в камни.
  6). Разрастающаяся стенка - через некоторое время, если она  ого-
рожена со всех сторон камнями или стенками (кроме зеленой),она пре-
вращается в алмазы. если не огорожена - в камни.
  7). Выход на следующий этаж (похож на игральный кубик) - открыва-
ется после мерцания фона.

   "Жители" этажа:

  1). Квадрат - двигается по периметру свободного пространства.
  2). Бабочка - передвигается, как квадрат.
  3). Шарик   - передвигается в произвольном  направлении, отскаки-
вая от препятствий.

 При попадании камня (алмаза) в бабочку или Ќарик, они превращаются
в 9 алмазов.

 В этой игре есть редактор этажей.Вход в него осуществляется из за-
ставки нажатием клавиЌ "УС+СС+РУС/LАТ". Перемещения  курсора произ-
водится стрелками. выбор элемента этажа производится нажатием  кла-
виЌ "ЗБ"+">/<". Ннажимая несколько раз эти клавиЌи, Вы можете выби-
рать любой элемент этажа. Сставятся элементы нажатием клавиЌи "ЗБ".
Переход на следующий этаж: "ЗБ"+"^/V". Стрелка вверх листает  этажи
назад, стрелка вниз - вперед.
 Выход из редактора или игры "РУС/LAT".
 И в конце скажу: во время игры есть возможность смены этажа с  по-
мощью клавиЌ "УС"+"РУС/LAT".

                                                  Зубарев, г. Киров


      СТАНДАРТНЫЕ ПОДПРОГРАММЫ ВВОДА-ВЫВОДА В ФОРМАТЕ EDASM.COM
      ”””””””””””””””””””””””””””””””””””””””””””””””””””””””””

 Физический формат вывода на МЛ: 64 раза по 55Н, 64 раза  по  0, 64
раза по  55Н, 64 раза по 0, 5 раз по 0Е6Н, имя  программы, 256  раз
по 0, 0Е6Н, инвертированный младЌий байт длины файла, инвертирован-
ный старЌий байт длины файла, байты программы, 0FFЌ,  младЌий  байт
КС, старЌий байт КС.

 ;П/П ЗАГРУЗКИ В ФОРМАТЕ EDASM           ;загрузки имени тек.файла
 ORG 100Ќ                              I6:LXI Ќ,NAME2
 I: DI                                 CALL I11;ищем 5 синхробайтов
  XRA A   ;обнуляем признак оЌибки     I7:CALL IBYTE
  STA ERR                               MOV M,A
  CALL I4 ;ввод заголовка               ORA A
  PUSЌ Ќ                                INX Ќ
 I1:CALL IBYTE                          JNZ I7
  MOV B,A                               LXI Ќ,NAME2;сверяем с за-
  LDA FLAG ;выбор режима                LXI D,NAME1;данным именем
  INR A    ;"LOAD" или "VERIFY"        I8:LDAX D
  JNZ I2                                ORA A
  MOV A,B                               RZ
  CMP M                                 CMP M
  JNZ ERROR                             INX Ќ
 I2:MOV M,B                             INX D
  INR B    ;поиск конца файла (0FFЌ)    JZ I8
  INX Ќ                                 RET
  JNZ I1                               I9:MVI A,0FFЌ
  DCX Ќ                                I10:CALL IBYTE1
  MVI A,8                               MOV C,A
  CALL I10 ;ввод кс                     CALL IBYTE
  POP Ќ                                 MOV B,A
  PUSЌ B                                RET
  CALL KS  ;подсчет кс                 ;п/п поиска 5 синхробайтов
  XTЌL                                 I11:MVI B,4
  MOV D,B                               MVI A,0FFЌ
  MOV E,C                              I12:CALL IBYTE1
  CALL SRAV                             CPI 0E6Ќ
 I3:JNZ ERROR;если кс1 и кс2            JNZ I11
  POP Ќ    ;не равны, то оЌибка         DCR B
  EI                                    MVI A,8
  RET                                   JNZ I12
 ;п/п ввода заголовка                   RET
 I4:CALL I6  ;поиск нужного имени      ;п/п подсчета кс
  JNZ I4                               KS:LXI B,0
  CALL I9  ;ввод длины текста          KS1:MOV A,M
  LЌLD NACЌ                             CPI 0FFЌ
  LDA FLAG ;выбор режима "LOAD"         RZ
  DCR A    ;или "MERGE"                 ADD C
  JM I5                                 MOV C,A
  LЌLD NACЌ1                            MVI A,0
 I5:XCЌG      ;проверяем, войдет ли     ADC B
  LXI Ќ,KON ;загружаемый файл           MOV B,A
  DAD B                                 INX Ќ
  XCЌG                                  JMP KS1
  CALL SRAV                            ;п/п ввода байта
  RC                                   IBYTE:MVI A,8
 ERROR:POP Ќ ;генерируем оЌибку        IBYTE1:PUSЌ B
  MVI A,1                               PUSЌ D
  STA ERR                               MVI C,0
  EI                                    MOV D,A
  RET                                   IN 01
 ;п/п сравнения ЌL и DE                 ANI 10Ќ
 SRAV:MOV A,Ќ                           MOV E,A
  CMP D                                IBYTE2:IN 1
  RNZ                                   ANI 10Ќ
  MOV A,L                               CMP E
  CMP E                                 JZ IBYTE2
  RET                                   RLC


  RLC
  RLC
  RLC
  MOV A,C
  RAL
  MOV C,A
  PUSЌ PSW
  LDA CONR
  MOV B,A
  POP PSW
 IBYTE3:DCR B
  JNZ IBYTE3
  IN 1
  ANI 10Ќ
  MOV E,A
  MOV A,D
  ORA A
  JP IBYTE5
  MOV A,C
  CPI 0E6Ќ
  JNZ IBYTE4
  XRA A
  STA PRINV
  JMP IBYTE6
 IBYTE4:CPI 19
  JNZ IBYTE2
  MVI A,255
  STA PRINV
 IBYTE6:MVI D,9
 IBYTE5:DCR D
  JNZ IBYTE2
  LDA PRINV
  XRA C
  POP D
  POP B
  RET
 CONR:DB 4BЌ;константа чтения
 PRINV:DB 0 ;признак инверсии канала
 FLAG:DB 1;режим:0FFЌ-"VERIFY",0-"LOAD",1-"MERGE"
 NACЌ:DW 2000Ќ;адрес начала текстового буфера
 NACЌ1:DW 4000Ќ;адрес,определяющий место загрузки при "MERGE"
 ERR:DB 0;признак оЌибки (1-оЌибка)
 KON:EQU 8000Ќ;макс. адрес конца текста
 NAME1:DB 'LOADASM',0 ;Ќаблон имени для загрузки/выгрузки
 NAME2:DW 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;вводимое имя с МЛ
 ;П/П ВЫГРУЗКИ ФАЙЛА В ФОРМАТЕ EDASM
 O:DI
  LЌLD NACЌ
  CALL KS   ;подсчет кс
  CALL O8   ;определение конца текста
  PUSЌ B
  PUSЌ D
  CALL O1   ;вывод преамбулы
  XTЌL
  XCЌG
  LXI Ќ,NAME1
  CALL O5   ;вывод 5 синхробайт и имени
  CALL O3   ;вывод нулевых байтов
  POP D
  LЌLD NACЌ ;определяем длину текста


  MOV A,Ќ                               ;п/п вывода байта на МЛ
  CMA                                   OBYTE:PUSЌ B
  MOV Ќ,A                                PUSЌ D
  MOV A,L                                PUSЌ PSW
  CMA                                    MOV D,A
  MOV L,A                                MVI C,8
  INR L                                 OBYTE1:MOV A,D
  DAD D                                  RLC
  MVI A,0E6Ќ;выводим инвертированную     MOV D,A
  CALL OBYTE;длину на МЛ                 MVI A,1
  MOV A,L                                XRA D
  CMA                                    ANI 1
  CALL OBYTE                             OUT 0
  MOV A,Ќ                                CALL OBYTE2
  CMA                                    MVI A,0
  LЌLD NACЌ ;выводим текст               XRA D
  CALL O7                                ANI 1
  POP B                                  OUT 0
  MOV A,C   ;выводим кс                  CALL OBYTE2
  CALL OBYTE                             DCR C
  MOV A,B                                JNZ OBYTE1
  CALL OBYTE                             POP PSW
  EI                                     POP D
  RET                                    POP B
 ;п/п вывода преамбулы                   RET
 O1:MVI D,4                             OBYTE2:PUSЌ PSW
  XRA A                                  LDA CONZAP
 O2:MVI E,40Ќ                            MOV B,A
  XRI 55Ќ                                POP PSW
  CALL O4                               OBYTE3:DCR B
  DCR D                                  JNZ OBYTE3
  JNZ O2                                 RET
  RET                                   CONZAP:DB 32Ќ;константа
 ;п/п вывода 256 нулевых байт                        ;записи
 O3:XRA A
  MOV E,A
 O4:CALL OBYTE
  DCR E
  JNZ O4
  RET
 ;п/п вывода 5 синхробайт и инф.байт
 O5:MVI A,0E6Ќ
  MVI B,4
 O6:CALL OBYTE
  DCR B
  JNZ O6
 O7:CALL OBYTE
  CALL SRAV
  MOV A,M
  INX Ќ
  JNZ O7
  JMP OBYTE
 ;п/п определения конца текста
 O8:LXI D,NAME1
 O9:LDAX D
  ORA A
  INX D
  JNZ O9
  DCX D
  RET
  END
